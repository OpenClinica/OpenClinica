<?xml version="1.0"?>
<queries>
	<query>
		<name>findByPK</name>
        <sql>SELECT ss.*,st.unique_identifier FROM study_subject ss, study st WHERE
        ss.study_subject_id = ? and ss.study_id = st.study_id</sql>
	</query>
	<query>
		<name>findByPKAndStudy</name>
		<sql>
			SELECT ss.*
			FROM study_subject ss, study st
			WHERE ss.study_subject_id = ?
				AND ss.study_id=st.study_id
				AND (st.study_id=? or st.parent_study_id=?)
		</sql>
	</query>
    <query>
        <name>findByOidAndStudy</name>
        <sql>SELECT SS.*
            FROM STUDY_SUBJECT SS, study st
            WHERE SS.oc_oid = ?
                AND SS.study_id = st.study_id
                AND (st.study_id=? or st.parent_study_id=?)
        </sql>
    </query>
    <query>
        <name>findByOid</name>
        <sql>SELECT SS.*
            FROM STUDY_SUBJECT SS
            WHERE SS.oc_oid = ?
        </sql>
    </query>
    <query>
        <name>getCountofStudySubjectsAtStudyOrSite</name>
        <sql>select count(*) as count from study_subject where study_id = ?</sql>
    </query>
    <query>
        <name>getCountofStudySubjectsAtStudyOrSite</name>
        <sql>select count(*) as count from study_subject where study_id = ?</sql>
    </query>
    <query>
        <name>getCountofStudySubjectsAtStudy</name>
        <sql>
            select count(*) as count from study_subject, study s
                where s.study_id = study_subject.study_id and
                (s.study_id = ? or s.parent_study_id = ?)
        </sql>
    </query>
    <query>
        <name>getCountofStudySubjects</name>
        <sql>
            select count(distinct ss.study_subject_id) as count from study_subject ss, study s where
                ss.study_id = s.study_id AND
                ( s.study_id = ? or s.parent_study_id = ? )
        </sql>
    </query>
    <query>
        <name>getCountofStudySubjectsBasedOnStatus</name>
        <sql>
            select count(DISTINCT(ss.study_subject_id)) as count from study_subject ss,study s, status where
                status.status_id = ss.status_id  AND
                ss.study_id = s.study_id AND
                ( s.study_id = ? or s.parent_study_id = ? ) AND
                status.status_id = ?
        </sql>
    </query>
    <query>
        <name>getCountWithFilter</name>
        <sql>SELECT COUNT( DISTINCT  SS.study_subject_id) as count
                FROM study_subject ss LEFT JOIN study_event se ON ss.study_subject_id = se.study_subject_id,STUDY ST,SUBJECT S
                where
                    SS.SUBJECT_ID=S.SUBJECT_ID
                    AND SS.study_id = ST.study_id
                    AND (ST.study_id=? or ST.parent_study_id=?)
        </sql>
    </query>
    <query>
        <name>getWithFilterAndSort</name>
        <sql>
        SELECT * from (
            SELECT x.*, rownum as r from(select DISTINCT ss.*, ST.unique_identifier 
                FROM study_subject ss LEFT JOIN study_event se ON
                ss.study_subject_id = se.study_subject_id,STUDY ST,SUBJECT S
                where
                    SS.SUBJECT_ID=S.SUBJECT_ID
                    AND SS.study_id = ST.study_id
                    AND (ST.study_id=? or ST.parent_study_id=?)
        </sql>
    </query>
    <query>
        <name>findAllByStudySDV</name>
        <sql>
            SELECT * from (select x.*, rownum as r from(
            SELECT mss.* FROM study_subject mss, study mst
            WHERE
            mss.study_id = mst.study_id AND
            (mst.study_id=? or mst.parent_study_id=?) 
        </sql>
    </query>

     <query>
        <name>countAllByStudySDV</name>
        <sql>
            SELECT COUNT( mss.study_subject_id) as count FROM study_subject mss, study mst
            WHERE
            mss.study_id = mst.study_id AND
            (mst.study_id=? or mst.parent_study_id=?) 
        </sql>
    </query>
    
    <query>
        <name>getCountWithFilterListDiscNotes</name>
        <sql><![CDATA[SELECT COUNT( DISTINCT  SS.study_subject_id) as count
              FROM study_subject SS,STUDY ST, study_event SE,dn_item_data_map didm, discrepancy_note dn where
                SS.study_id = ST.study_id AND
                ss.study_subject_id = se.study_subject_id AND
                (ST.study_id=? or ST.parent_study_id= ?) AND
                didm.study_subject_id =  ss.study_subject_id AND
                didm.discrepancy_note_id = dn.discrepancy_note_id
        ]]></sql>
    </query>
    <query>
        <name>getWithFilterAndSortListDiscNotes</name>
        <sql><![CDATA[
                 SELECT * from (
                    SELECT x.*, rownum as r from(select DISTINCT ss.*
                  FROM study_subject SS,STUDY ST, study_event SE,dn_item_data_map didm, discrepancy_note dn where
                SS.study_id = ST.study_id AND
                ss.study_subject_id = se.study_subject_id AND
                (ST.study_id=? or ST.parent_study_id= ?) AND
                didm.study_subject_id =  ss.study_subject_id AND
                didm.discrepancy_note_id = dn.discrepancy_note_id
        ]]></sql>
    </query>
    
    
    
    <query>
        <name>getCountWithFilterAuditLog</name>
        <sql>SELECT COUNT( DISTINCT  SS.study_subject_id) as count
                FROM study_subject ss LEFT JOIN study_event se ON ss.study_subject_id = se.study_subject_id,STUDY ST,SUBJECT S,USER_ACCOUNT UA
                where
                    SS.SUBJECT_ID=S.SUBJECT_ID
                    AND SS.study_id = ST.study_id
                    AND SS.owner_id = UA.user_id
                    AND (ST.study_id=? or ST.parent_study_id=?)
        </sql>
    </query>
    <query>
        <name>getWithFilterAndSortAuditLog</name>
        <sql>
            SELECT * from ( select x.*, rownum as r from(
            SELECT DISTINCT ss.*, s.date_of_birth,s.unique_identifier, ua.user_name
                FROM study_subject ss LEFT JOIN study_event se ON ss.study_subject_id = se.study_subject_id,STUDY ST,SUBJECT S,USER_ACCOUNT UA
                where
                    SS.SUBJECT_ID=S.SUBJECT_ID
                    AND SS.study_id = ST.study_id
                    AND SS.owner_id = UA.user_id
                    AND (ST.study_id=? or ST.parent_study_id=?)
        </sql>
    </query>
    <query>
		<name>findAll</name>
		<sql>SELECT * FROM study_subject</sql>
	</query>

    <query>
		<name>findAnotherBySameLabel</name>
		<sql>
			SELECT ss.*
			FROM study_subject ss, study st
			WHERE ss.label=?
				AND ss.study_id=st.study_id
				AND st.study_id=?
				AND ss.study_subject_id != ?

		</sql>
	</query>

    <query>
		<name>findAnotherBySameLabelInSites</name>
		<sql>
			SELECT ss.*
			FROM study_subject ss, study st
			WHERE ss.label=?
				AND ss.study_id=st.study_id
				AND st.parent_study_id=?
				AND ss.study_subject_id != ?

		</sql>
	</query>

	<query>
		<name>findByLabelAndStudy</name>
		<sql>
			SELECT ss.*
			FROM study_subject ss, study st
			WHERE ss.label=?
				AND ss.study_id=st.study_id
				AND (st.study_id=? or st.parent_study_id=?)
		</sql>
	</query>
	<query>
		<name>findSameByLabelAndStudy</name>
		<sql>
			SELECT ss.*
			FROM study_subject ss, study st
			WHERE ss.label=?
				AND ss.study_id=st.study_id
				AND (st.study_id=? or st.parent_study_id=?)
				AND ss.study_subject_id != ?
		</sql>
	</query>
	<query>
		<name>findAllByStudy</name>
		<sql>
			SELECT ss.*
			FROM study_subject ss, study st
			WHERE ss.study_id = st.study_id
				AND (st.study_id=? or st.parent_study_id=?)
		</sql>
	</query>
	<query>
		<name>findAllByStudyId</name>
		<sql>
	        SELECT  s.unique_identifier, s.gender, ss.*, stu.name
	        FROM subject s, study_subject ss, study stu
	        WHERE s.subject_id = ss.subject_id
			    AND ss.study_id = stu.study_id
			    AND (stu.study_id=? or stu.parent_study_id=?)
	        	AND s.status_id=1
	        	order by ss.date_updated desc
        </sql>
	</query>
	<query>
		<name>findAllByStudyIdAndLimit</name>
		<sql>
	        SELECT  s.unique_identifier, s.gender, ss.*, stu.name
	        FROM subject s, study_subject ss, study stu
	        WHERE s.subject_id = ss.subject_id
			AND ss.study_id = stu.study_id
			AND (stu.study_id=? or stu.parent_study_id=?)
	        AND s.status_id=1
            and rownum &lt;= 5
	        order by ss.date_updated desc
        </sql>
	</query>
	<query>
		<name>create</name>
		<sql>
            INSERT INTO study_subject
            (LABEL,  SUBJECT_ID,  STUDY_ID, STATUS_ID,
             DATE_CREATED, OWNER_ID, ENROLLMENT_DATE, SECONDARY_LABEL, OC_OID)
            VALUES (?,?,?,?,sysdate,?,?,?,?)
		</sql>
	</query>
	<query>
		<name>update</name>
		<sql>
		  UPDATE study_subject SET LABEL=?,  SUBJECT_ID=?,  STUDY_ID=?,
		  STATUS_ID=?, ENROLLMENT_DATE=?, DATE_UPDATED=?,
		  UPDATE_ID=?, SECONDARY_LABEL=? WHERE STUDY_SUBJECT_ID=?
	    </sql>
	</query>
	<query>
		<name>getCurrentPK</name>
		<sql>SELECT study_subject_id_seq.currval AS key from dual</sql>
	</query>
	<query>
		<name>findAllWithStudyEvent</name>
		<sql>
			SELECT DISTINCT
				S.*
			FROM
				study_subject S
				, study_event E
				, study st
			WHERE
				S.study_subject_id = E.study_subject_id
				AND S.study_id=st.study_id
				AND (st.study_id=? or st.parent_study_id=?)
		</sql>
	</query>
	<query>
		<name>findBySubjectIdAndStudy</name>
		<sql>
            SELECT ss.*, st.unique_identifier
            FROM study_subject ss, study st
            WHERE ss.subject_id=?
                AND ss.study_id=st.study_id
                AND (st.study_id=? or st.parent_study_id=?)
		</sql>
	</query>
	<query>
		<name>findAllBySubjectId</name>
		<sql>
			SELECT *
			FROM study_subject WHERE subject_id=?
		</sql>
	</query>
	<query>
		<name>findAllByStudyOrderByLabel</name>
		<sql>
			SELECT ss.*
			FROM study_subject ss, study st
			WHERE ss.study_id = st.study_id
				AND (st.study_id=? or st.parent_study_id=?)
			ORDER BY ss.label ASC
		</sql>
	</query>
	<query>
		<name>findAllActiveByStudyOrderByLabel</name>
		<sql>
			SELECT ss.*
			FROM study_subject ss, study st
			WHERE ss.study_id = st.study_id
				AND (st.study_id=? or st.parent_study_id=?)
				AND (ss.status_id=1 or ss.status_id=8)
			ORDER BY ss.label ASC
		</sql>
	</query>
</queries>
